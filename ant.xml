<?xml version="1.0" encoding="U`F-8"?>
<project name="Coursework" default="all" basedir=".">
    <target name="init_jboss">
        <property name="server_root" value="D:/jboss-4.0.4.GA/"/>
        <property name="server_deploy" value="${server_root}/server/default/deploy"/>
        <property name="servlet_jar" value="${server_root}server/default/lib/javax.servlet.jar"/>
        <property name="servlet_jsp_jar" value="${server_root}server/default/lib/javax.servlet.jsp.jar"/>
    </target>

    <target name="init_tomcat" if="tomcat">
        <property name="server_root" value="D:/Tomcat 4.1"/>
        <property name="server_deploy" value="${server_root}/webapps"/>
        <property name="servlet_jar" value="${server_root}/common/lib/servlet.jar"/>
    </target>

    <target name="init" depends="init_jboss, init_tomcat">
        <property name="outdir" value="./output"/>
        <property name="classes" value="${outdir}/webclasses"/>
        <property name="lib" value="${outdir}/lib"/>
    </target>

    <target name="prepare" depends="init">
        <mkdir dir="${outdir}"/>
        <mkdir dir="${classes}"/>
        <mkdir dir="${lib}"/>
    </target>

    <target name="compile" depends="prepare">
        <echo>${servlet_jar}</echo>
        <javac srcdir="./src" destdir="${classes}">
            <classpath>
                <pathelement location="${servlet_jar}"/>
                <pathelement location="${servlet_jsp_jar}"/>
            </classpath>
        </javac>
    </target>

    <target name="package" depends="compile">
        <jar destfile="${lib}/lib.jar" basedir="${classes}" includes="**/integration/*.*, **/business/*.*, **/presentation/*.*"/>
        <copy todir="${lib}">
            <fileset dir="./lib">
                <include name="mysql-connector-java-5.1.2.jar" />
            </fileset>
        </copy>
        <war destfile="${outdir}/Coursework.war" webxml="./meta-data/web.xml">
            <fileset dir="./web"/>
            <fileset dir="./lib"/>
            <classes dir="${classes}">
                <exclude name="**/integration/*.*"/>
                <exclude name="**/business/*.*"/>
                <exclude name="**/presentation/*.*"/>
            </classes>
            <lib dir="${lib}"/>
        </war>
    </target>

    <target name="deploy" depends="package">
        <copy file="${outdir}/Coursework.war" todir="${server_deploy}"/>
    </target>

    <!-- target will only run if tomcat was set to true on the command line -->
    <target name="tomcatclean" if="tomcat">
        <!-- Need to remove the directory created by tomcat from the .war file or it won't be updated by new war file -->
        <delete dir="${server_deploy}/Coursework"/>
    </target>

    <target name="clean" depends="init, tomcatclean">
        <delete dir="${outdir}"/>
        <delete file="${server_deploy}/Coursework.war"/>
    </target>

    <target name="all" depends="clean, deploy">
    </target>
</project>